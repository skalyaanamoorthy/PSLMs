#!/bin/bash
#SBATCH --time=2:0:0
#SBATCH --account=def-skal
#SBATCH --ntasks=1
#SBATCH --cpus-per-task=8
#SBATCH --mem-per-cpu=8GB
#SBATCH --array=0-230

declare  -a VALUES=(0 12 22 23 2503 2543 3387 3411 5815 8005 8183 8212 8248 8260 8284 8294 8630 8636 8687 8697 8705 8719 8722 8762 8771 8773 9718 9794 9815 9871 10231 10253 10343 10359 10387 10423 10567 10959 10965 10981 10982 11056 11256 11308 11315 11611 11669 11692 11745 11787 11861 12242 12710 13304 13467 13655 15350 27678 27745 27838 28008 28016 28088 28172 28180 29083 29084 29187 29255 29257 29301 29576 29583 29589 29661 29877 30589 31128 32463 32541 32605 32677 32755 32866 32883 32970 33017 33219 33222 33945 33947 33951 34398 34426 34580 34664 34691 34731 34816 34978 35022 35054 35064 35071 35079 35142 35159 35276 35366 35383 35391 35436 35618 36160 36409 36601 36666 36687 36699 36715 36843 37007 37297 37321 37340 37383 37625 37768 37935 38032 38048 38220 38249 38263 38287 38431 38597 38633 38637 38660 38797 38800 38880 39143 39166 39216 39224 39317 39320 39323 39331 39548 39696 39715 39721 39792 39811 39820 39905 40014 41338 41381 41399 42047 42155 43941 43981 44084 44263 44690 44760 44772 45360 45407 46983 47061 47085 47195 47261 47268 48483 48508 48601 48602 48628 49138 49257 49705 49761 49773 49800 49817 49820 50016 50021 50027 50037 50092 50096 50116 50303 50337 50423 50427 50766 50797 50800 50814 50880 50881 50884 51339 51489 51514 51898 52587 52588 52598 52600 52602 52630 52636 52637 52748 52763 52815 52817 52827 52836 52838)

SLURM_ARRAY_TASK_ID=${VALUES[${SLURM_ARRAY_TASK_ID}]}

# the array above is the sequence output by preprocess.py

source ../pslm/bin/activate

### The below section looks up information on the protein like the sequence and MSA of interest
IFS=','
text=$(cat ../data/preprocessed/fireprot_mapped.csv | head -n $((${SLURM_ARRAY_TASK_ID}+2)) | tail -n 1)
read -a strarr <<< "$text"
code=${strarr[1]}; echo $code
chain=${strarr[2]}; echo $chain
wt=${strarr[3]}; echo $wt
pos=${strarr[4]}; echo $pos
mut=${strarr[5]}; echo $mut
up=${strarr[6]}; echo $up
seq=${strarr[7]}; echo $seq
msa=${strarr[8]}; echo $msa

python ../inference_scripts/subsample_one.py --msa_file $msa --dataset 'fireprot'
