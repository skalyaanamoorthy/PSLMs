#!/bin/bash
#SBATCH --time=12:0:0
#SBATCH --account=def-skal
#SBATCH --ntasks=1
#SBATCH --cpus-per-task=8
#SBATCH --mem-per-cpu=4GB
#SBATCH --array=[0,1,6,9,20,29,38,99,100,101,128,191,195,206,207,209,211,215,224,225,375,399,438,454,459,461,496,498,517,526,533,542,543,551,606,610,612,658,676,680,682,686,690,704,731,742,743,756,801,805,833,835,839,840,868,892,915,924,927,929,945,947,956,965,979,980,981,984,990,991,997,1019,1020,1026,1034,1056,1060,1066,1069,1072,1076,1090,1101,1104,1109,1118,1124,1126,1143,1154,1174,1186,1187,1189,1193,1197,2026,2071,2079,2080,2081,2124,2125,2126,2129,2186,2194,2201,2217,2251,2253,2304,2343,2348,2825,2827,2829,2836,2848,2854,2858,2927,2965,3011,3031,3059,3060,3069,3071,3076,3081,3083,3084,3093,3097,3099,3100,3107,3138,3167,3171,3172,3175,3255,3265,3271,3272,3299,3300,3304,3313,3314,3320,3323,3327,3328,3330,3332,3335,3339,3345,3431,3433,3438,3441,3442,3443,3445,3459,3528,3536,3540,3568,3572,3574,3576,3580,3609,3611,3612,3646,3647,3650,3653,3682,3695,3696,3700,3701,3723,3724,3729,3733,3753,3759,3765,3806,3810,3811,3816,3819]

#[0,1,5,8,19,23,28,47,48,49,55,83,86,93,94,96,97,101,196,204,215,226,231,248,250,261,266,270,278,279,286,323,326,328,344,352,356,357,361,365,379,382,388,389,399,420,423,448,449,450,458,464,483,488,491,493,501,503,509,511,523,524,527,533,534,538,553,554,560,564,570,574,578,580,583,586,600,605,607,608,616,619,621,625,636,647,657,658,660,662,666,1423,1441,1447,1448,1449,1481,1482,1483,1485,1510,1511,1518,1523,1546,1547,1570,1595,1600,1804,1806,1808,1812,1816,1817,1847,1881,1898,1912,1922,1925,1930,1934,1935,1942,1943,1950,1960,1983,1986,1987,1990,2025,2030,2031,2038,2039,2040,2049,2050,2052,2053,2057,2058,2060,2061,2063,2066,2072,2143,2146,2149,2150,2162,2179,2184,2205,2208,2210,2211,2214,2220,2221,2222,2256,2258,2261,2267,2271,2272,2282,2283,2288,2292,2309,2314,2320,2358,2362,2363,2367]

# the array above is the sequence output by preprocess.py

source ../pslm/bin/activate

### The below section looks up information on the protein like the sequence and MSA of interest
IFS=','
text=$(cat ../data/preprocessed/korpm_full_mapped.csv | head -n $((${SLURM_ARRAY_TASK_ID}+2)) | tail -n 1)
read -a strarr <<< "$text"
code=${strarr[1]}; echo $code
chain=${strarr[2]}; echo $chain
wt=${strarr[3]}; echo $wt
pos=${strarr[4]}; echo $pos
mut=${strarr[5]}; echo $mut
up=${strarr[6]}; echo $up
seq=${strarr[7]}; echo $seq
msa=${strarr[8]}; echo $msa

python ../inference_scripts/subsample_one.py --msa_file $msa --dataset 'korpm_full' --replace #--neff_only
