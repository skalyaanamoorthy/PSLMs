#!/bin/bash
#SBATCH --time=12:0:0
#SBATCH --account=def-skal
#SBATCH --ntasks=1
#SBATCH --cpus-per-task=8
#SBATCH --mem-per-cpu=8GB
#SBATCH --array=17,359,360,361

#0,4,17,20,48,51,52,170,231,233,234,239,305,323,337,342,343,344,345,346,347,348,349,350,351,352,353,354,355,356,357,358,359,360,361,362,363,364,365,366,367,368,369,370,371,372,373,374,375,376,377,378,379,380,381,382,383,384,385,386,387,388,389,390,391,392,393,394,395,396,397,398,399,400,401,402,403,404,405,406,407,408,409,410,411,412,413,414,415,416,417,418,419,420,421,422,423,424,425,426,427,428,429,430,431,432,433,434,435,436,437,438,439,440,441,442,443,444,445,446,447,448,449,450,451,452,453,454,455,456,457,458,459,460,461,462,463,464,465,466,467,468,469,470,471,472,473,474,475,476,477,478,479,480,481,482,483,484,485,486,487,488,489,490,491,492,493,494,495,496,497,498,499,500,501,502,503,504,505,506,507,508,509,510,511,512,513,514,515,516,517,518,519,520,521,522,523,524,525,526,527,528,529,530,531,532,533,534,535,536,537,538,539,540,541,542,543,544,545,546,547,548,549,550,551,552,553,554,555,556,557,558,559,560,561,562,563,564,565,566,567,568,569,570,571,572,573,574,575,576,577,578,579,580,581,582,583,584,585,586,587,588,589,590,591,592,593,594,595,596,597,598,599,600,601,602,603,604,605,606,607,608,609,610,611,612,613,614,615,616,617,618,619,620,621,622,623,624,625,626,627,628,629,630,631,632,633,634,635,636,637,638,639,640,641,642,643,644,645,646,647,648,649,650,651,652,653,654,655,656,657,658,659,660,661,662,663,664,665,666,667,668,669,670,671,672,673,674,675,676,677,678,679,680,681,682,683

#0,1,14,18,20,21,23,73,74,78,79,80,81,94,105,132,133,182,183,185,187,188,189,192,195,196,202,203,206,209,214,218,235,237,243,263,267,272,273,280,281,285,287,294,298,303,307,308,311,313,317,319,320,366,417,420,429,431,437,439,442,443,445,446,463,531,533,535,564,572,574,575,587,590,595,626,627,628,632,635,636,638,644,648,649,650,652,655,658,661,662,663,665,666

#0,5,10,13,23,32,99,103,105,125,129,132,159,223,224,225,236,237,238,241,243,244,415,416,417,426,487,503,577,584,586,612,620,634,637,644,694,698,711,713,744,763,764,768,775,811,822,823,824,860,871,873,899,909,919,922,923,928,934,935,939,955,960,969,983,998,999,1001,1002,1006,1038,1042,1058,1173,1176,1182,1188,1191,1194,1202,1203,1239,1277,1333,1338,1339,1351,1364,1365,1403,1413,1429,1473,1494,1496,1546,1549,1644,1672,1686,1716,1723,1724,2276,2282,2316,2335,2347,2353,2390,2395,2403,2408,2455,2547,2562,2613,2650,2659,2652,2662,2663,2694,2698,2721,2725,2749,2828,2830,2839,2840,2850,2861,3140,3149,3226,3231,3239,3247,3248,3251,3261,3284,3292,3311,3321,3323,3382,3411

# the array above is the sequence output by preprocess.py

source ../pslm/bin/activate

### The below section looks up information on the protein like the sequence and MSA of interest
IFS=','
text=$(cat ../data/Ssym_mapped.csv | head -n $((${SLURM_ARRAY_TASK_ID}+2)) | tail -n 1)
read -a strarr <<< "$text"
code=${strarr[1]}; echo $code
chain=${strarr[2]}; echo $chain
wt=${strarr[3]}; echo $wt
pos=${strarr[4]}; echo $pos
mut=${strarr[5]}; echo $mut
up=${strarr[6]}; echo $up
seq=${strarr[7]}; echo $seq
msa=${strarr[8]}; echo $msa

python ../inference_scripts/subsample_one.py --msa_file $msa --dataset 'ssym' --neff_only
