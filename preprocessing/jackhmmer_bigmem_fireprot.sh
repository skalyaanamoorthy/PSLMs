#!/bin/bash
#SBATCH --time=2-0:0:0 
#SBATCH --account=rrg-skal 
#SBATCH --cpus-per-task=16
#SBATCH --mem-per-cpu=4GB
#SBATCH --nodes 1
#SBATCH --array=[0,6,11,21,31,36,41,51,121,131,134,162,166,167,171,198,199,267,268,282,286,302,325,326,329,333,334,336,346,347,523,524,525,534,604,605,621,623,699,701,711,718,720,725,728,754,767,781,797,802,810,822,882,888,892,905,907,909,940,941,960,961,964,968,969,985,992,1030,1078,1079,1130,1140,1142,1145,1154,1182,1198,1222,1251,1261,1265,1275,1281,1289,1292,1360,1362,1363,1364,1378,1394,1399,1408,1422,1437,1438,1440,1444,1446,1449,1452,1455,1461,1463,1471,1475,1478,1512,1516,1518,1533,1668,1680,1683,1691,1692,1701,1707,1715,1722,1730,1736,1740,1792,1795,1798,2735,2789,2802,2957,2963,2964,2976,3021,3022,3023,3024,3031,3077,3087,3103,3167,3188,3190,3256,3260,3372,3386,3464,3465,4034,4043,4055,4058,4063,4103,4122,4128,4140,4141,4147,4187,4235,4236,4254,4255,4257,4262,4309,4401,4432,4433,4510,4522,4577,4580,4581,4583,4597,4607,4609,4617,4649,4653,4678,4684,4708,4710,4741,4827,4828,4830,4847,4848,4868,4872,4883,5212,5290,5299,5378,5379,5392,5395,5405,5450,5458,5459,5473,5483,5519,5529,5532,5541,5562,5598,5676,5766,5777,5781,5784,5846,5865,5897,5907,5917,5946,6157,6160,6311]

module purge

module load hmmer/3.2.1
IFS=','
text=$(cat ./data/fireprot_unique_muts_offsets.csv | head -n $((${SLURM_ARRAY_TASK_ID}+2)) | tail -n 1)
read -a strarr <<< "$text"
folder=${strarr[1]}; echo $folder
#cd $folder
cd msas_fireprot_new_july_17

name=$(find ../sequences/fasta_up/ -name $folder'_[0-9A-Z].fa')
th=$(cat $name | tail -n 1 | wc -m) 
th=$(( th / 2 ))
echo $th
echo ${folder}_MSA

jackhmmer --incT $th --cpu 16 -A ${folder}_MSA -N 8 $name ../../uniref/uniref100.fasta
